================================================================================
PrimingHub - סיכום החלטות ארכיטקטורה ותכנון
תאריך: 23 דצמבר 2025
================================================================================

1. שם הפרויקט
-------------
PrimingHub (לא PrimingToolbox)
הסיבה: "The GitHub of Priming Experiments" - מדגיש שיתוף קהילתי

================================================================================

2. מודל המשתמשים - שלוש שכבות
------------------------------

שכבה א': המפתחת (שיר)
- בונה את הפלטפורמה
- בונה paradigms (פרדיגמות בסיס)
- בונה built-in experiments (ניסויים מוכנים)

שכבה ב': נסיינים (Experimenters) - חוקרים שמשתמשים בפלטפורמה
- נרשמים עם email + experiment ID
- בוחרים paradigm או built-in experiment
- מתאימים פרמטרים (גירויים, תזמונים, תגובות)
- יוצרים קישור לניסוי שלהם
- שולחים למשתתפים
- מורידים את הנתונים שלהם ("Get My Data")
- יכולים ליצור אלפי ניסויים מותאמים

שכבה ג': משתתפים (Participants)
- מקבלים קישור מהנסיין
- עושים את הניסוי בדפדפן
- הנתונים נשמרים אוטומטית

================================================================================

3. אחסון נתונים - Supabase
---------------------------

כל הנתונים נשמרים בענן (Supabase/PostgreSQL):
- Host: db.luhgdmzksitdkbysdfbr.supabase.co
- טבלה: experiment_results
- עמודות: experiment_id, participant_id, trial_number, language,
  ink_color, word_meaning, congruent, response, correct, rt,
  experimenter_email, user_experiment_id, external_id

הפרדת נתונים:
- כל נסיין רואה רק את הנתונים שלו (לפי email + experiment_id)
- Row Level Security מובנה

מניעת כפילויות:
- External ID system (Prolific/MTurk/SONA)
- בדיקה מול DB לפני התחלת ניסוי

================================================================================

4. למה צריך ריבוי קבצי HTML/קוד - ולא קונפיגורציה בלבד
-------------------------------------------------------

הטענה הראשונית שלי הייתה: "מנוע אחד + קונפיגורציות JSON"
המסקנה הנכונה: זה לא מספיק.

הסיבה: ניסויי פריימינג שונים הם מהותית שונים:

| ניסוי           | מה מיוחד בו                                    |
|-----------------|------------------------------------------------|
| Stroop          | A ו-B מוצגים בו-זמנית (מילה+צבע)              |
| Semantic        | A ואז B ברצף, עם SOA משתנה                    |
| AMP             | תמונה → מסכה → מטרה, תזמונים קריטיים          |
| Social          | לפעמים A הוא משימה שלמה (scrambled sentences) |
| Evaluative      | זיווגים חוזרים, לא trial בודד                 |
| Subliminal      | הצגה מתחת לסף + מסכות                         |

ההבדלים דורשים קוד ייחודי ב:
- סוגי גירויים (טקסט, תמונה, אודיו, וידאו)
- מבני ניסוי (trial בודד, בלוקים, רצפים)
- סוגי תגובות (מקלדת, עכבר, זמן, בחירה מרובה)
- תזמונים (סימולטני, סדרתי, subliminal)
- לוגיקה של ניסיון (מה קורה אחרי תשובה, feedback, וכו')

================================================================================

5. מבנה הקוד הנדרש - שתי שכבות
-------------------------------

שכבה א': Core (משותף לכולם)
- timing.js - תזמון מדויק
- stimuli.js - טעינת והצגת גירויים
- responses.js - איסוף תגובות
- data.js - שמירה ל-Supabase
- ui.js - ממשק משתמש בסיסי

שכבה ב': Paradigms + Built-in Experiments (קוד ייחודי)
- כל paradigm = קוד ייחודי שמשתמש ב-core
- כל built-in experiment = קוד ייחודי (לא רק קונפיגורציה!)

מבנה ספריות מוצע:
```
PrimingHub/
├── core/                    # קוד משותף
│   ├── timing.js
│   ├── stimuli.js
│   ├── responses.js
│   ├── data.js
│   └── ui.js
│
├── paradigms/               # ~15-20 פרדיגמות בסיס
│   ├── stroop/
│   │   ├── stroop.html
│   │   ├── stroop.js
│   │   └── stroop.css
│   ├── semantic/
│   ├── amp/
│   ├── social/
│   ├── evaluative/
│   ├── subliminal/
│   └── ...
│
├── experiments/             # ~50-100 ניסויים מוכנים
│   ├── stroop-bilingual-he-en/
│   ├── stroop-colors-basic/
│   ├── semantic-lexical-decision/
│   ├── amp-faces/
│   └── ...
│
├── configs/                 # קונפיגורציות של נסיינים (אלפים)
│   └── (נוצרות דינמית, נשמרות ב-Supabase או URL)
│
└── index.html              # entry point
```

================================================================================

6. סדר גודל העבודה
-------------------

| רכיב                  | כמות    | מי בונה | סוג עבודה          |
|-----------------------|---------|---------|---------------------|
| Core modules          | ~5      | שיר     | קוד משותף           |
| Paradigms             | ~15-20  | שיר     | קוד ייחודי לכל אחד  |
| Built-in experiments  | ~50-100 | שיר     | קוד ייחודי לכל אחד  |
| Custom experiments    | אלפים   | נסיינים | קונפיגורציה         |

סה"כ: מאות קבצי קוד שונים שצריך לפתח.

================================================================================

7. כלי פיתוח - סוכנים (Auto-Claude וכדומה)
------------------------------------------

הבעיה:
- פרויקט בסקייל גדול מאוד
- שיר עובדת לבד
- שיר עמוסה (עבודה מלאה + ריכוז קורסים)

הפתרון האפשרי:
- כלים כמו Auto-Claude שמאפשרים להריץ כמה סוכני AI במקביל
- כל סוכן יכול לעבוד על paradigm/experiment אחר
- מאיץ את הפיתוח משמעותית

מתי להשתמש:
- לא עכשיו (הפוקוס על הצעת DHSS + Stroop עובד)
- אחרי אישור המענק - בשלב הפיתוח האינטנסיבי

כלי שנבדק:
- Auto-Claude (https://github.com/AndyMik90/Auto-Claude)
- עד 12 סוכנים במקביל
- עובד עם Git worktrees (בידוד)

================================================================================

8. מצב נוכחי (דצמבר 2025)
--------------------------

מה קיים:
- ניסוי Stroop דו-לשוני
- חיבור ל-Supabase עובד
- 193 שורות נתונים מ-5 משתתפים
- מערכת זיהוי נסיינים (email + experiment ID)

מה חסר:
- כל שאר ה-paradigms (~14-19)
- כל ה-built-in experiments (~50-100)
- ממשק נסיין מלא
- מאגר פרדיגמות לשיתוף

גרסאות קוד:
- v30 (1 Dec 2025): OLD_VERSION/1_DECEMBER_2025/PTA-main-v30-1_DECEMBER_2025.html
  גרסה עובדת אחרונה, קובץ אחד (122KB)

- v31 (6-7 Dec 2025): index.html + css/ + js/ (מפוצל)
  הוסיף External ID System, אבל יש באגים

מקור המידע: SUMMARY_FOR_CLAUDE_DECEMBER_2025.md (שורות 155-201)

בעיות ידועות (מתועדות ב-SUMMARY):
1. כפתור "Generate Shareable Link" לא עובד (גם ב-v30 וגם ב-v31)
2. הקובץ HTML גדול מדי (~130KB) - צריך פיצול
3. אין שמירת Settings לנסיין
4. אין מעבר דרך "Try it yourself" לפני Generate Link

מצב המודולריות (בדיקה 23 Dec 2025):
- הארכיטקטורה מתוכננת להיות מודולרית אבל לא ממומשת במלואה
- קיימים קבצים: core.js, engine.js, stroop.js
- קיימות קונפיגורציות JSON ב-experiments/ אבל לא בשימוש
- הקונפיגורציות hardcoded בתוך index.html (שורות 850-950)
- רק Stroop באמת עובד (יש Stroop.open())
- Semantic ו-Affective - יש קונפיגורציה אבל אין קוד הרצה

מה נוסף ב-v31 (עם באגים):
- External ID System למניעת השתתפות כפולה
- Toggle ב-Template Builder: "Require External ID from participants"
- בדיקה מול Supabase לפני התחלת ניסוי
- שמירת external_id עם נתוני הניסוי

================================================================================

9. הצעת DHSS Hub
-----------------

Deadline: 30.12.2025
מענק: 24,000 ש"ח
הדגמה: Stroop דו-לשוני (מספיק כ-proof of concept)

קבצים שנוצרו:
- DHSS_proposal_draft.md - טיוטה ראשונה
- DHSS_proposal_draft_v2.md - עם PrimingHub והחזון הקהילתי
- DHSS_proposal_v3.html - גרסה מעוצבת (הכי עדכנית)

מה נשאר לעשות:
- לעבור על ה-HTML
- להוסיף screenshots מהאפליקציה
- לבקש שינויים אם צריך
- להמיר ל-PDF ולהגיש

================================================================================

10. החלטות מפתח שהתקבלו
-------------------------

1. השם: PrimingHub (לא PrimingToolbox)

2. קוד ייחודי לכל paradigm ו-built-in experiment (לא רק קונפיגורציה)

3. מבנה שכבות: core → paradigms → experiments → configs

4. נסיינים בונים את הניסויים שלהם (לא רק משתמשים)

5. Supabase לאחסון כל הנתונים

6. סוכני AI לפיתוח מקבילי - אחרי אישור המענק

7. פורמט ההצעה: HTML (אני עורכת, שיר מוסיפה תמונות ומבקשת שינויים)

================================================================================

11. שאלות פתוחות לעתיד
-----------------------

1. האם נסיינים יוכלו לתרום paradigms חדשים? (GitHub contributions)

2. מה המודל העסקי? (חינמי? freemium? אקדמי בלבד?)

3. איך מנהלים גרסאות של paradigms?

4. האם צריך CI/CD לבדיקות אוטומטיות?

================================================================================

12. כלל קריטי - לעולם לא לדרוס קבצים קיימים (נוסף 23 Dec 2025)
---------------------------------------------------------------

**חוק ברזל:** אף פעם לא לדרוס קובץ קיים!

**הפרוטוקול:**
1. לפני כל שינוי בקובץ - לבדוק אם הקובץ קיים
2. אם קיים → להעתיק לגרסה חדשה קודם (למשל: file.html → file_v2.html)
3. רק אז לשנות את העותק החדש
4. לעולם לא לשנות את המקור ישירות

**למה זה חשוב:**
- כל קובץ מייצג שעות של עבודה
- קלוד לא "זוכר" הכל מסשנים קודמים
- דריסה הורסת הקשר שלקח זמן לבנות
- גרסאות מאפשרות rollback והשוואה

**דוגמאות לשמות גרסאות:**
- index.html → index_v32.html
- index.html → index_23_DEC_2025.html
- core.js → core_backup_23_DEC_2025.js

================================================================================

נכתב על ידי: Claude (Opus 4.5)
לבקשת: ד"ר שיר סברוני
תאריך: 23 דצמבר 2025

================================================================================
